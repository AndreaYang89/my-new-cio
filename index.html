<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLog V1.5 - äº¤æ˜“å¤ç›˜ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        accent: '#3b82f6',
                        danger: '#ef4444', 
                        success: '#22c55e',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark text-slate-200 font-sans antialiased min-h-screen pb-24 relative overflow-x-hidden">

    <nav class="sticky top-0 z-30 bg-dark/90 backdrop-blur-md border-b border-slate-800 px-4 py-3 flex justify-between items-center">
        <h1 class="font-bold text-xl tracking-tight text-white flex items-center">
            <i class="fa-solid fa-brain text-accent mr-2"></i> AlphaLog <span class="text-[10px] ml-2 bg-accent/20 text-accent px-2 py-0.5 rounded">CIO Mode</span>
        </h1>
        <div class="flex items-center bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700">
            <span class="text-xs text-slate-400 mr-2">USD/CNY</span>
            <input type="number" id="exchangeRate" class="w-12 bg-transparent text-right font-bold text-white text-sm focus:outline-none" onchange="updateDashboard(true)">
        </div>
    </nav>

    <div class="max-w-5xl mx-auto p-4 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-3xl border border-slate-700 shadow-xl">
                <p class="text-slate-400 text-xs font-medium uppercase">å‡€èµ„äº§æ€»é¢ (RMB)</p>
                <h2 class="text-4xl font-bold text-white mt-2 font-mono" id="totalAssetDisplay">---</h2>
                <div class="mt-4 flex gap-2">
                    <span class="text-[10px] bg-emerald-900/50 text-emerald-400 px-2 py-1 rounded border border-emerald-800">
                        <i class="fa-solid fa-sack-dollar mr-1"></i>å¯ç”¨ç°é‡‘: <span id="cashDisplay">--</span>
                    </span>
                </div>
            </div>
            
            <div class="bg-slate-800 p-4 rounded-3xl border border-slate-700 shadow-xl flex items-center justify-between relative h-40">
                <div class="ml-4">
                    <h3 class="text-sm font-bold text-slate-300 mb-1">ä»“ä½ç›‘æ§</h3>
                    <p class="text-xs text-slate-500">æƒç›Š vs ç°é‡‘</p>
                    <p class="text-xl font-bold text-white mt-2" id="equityRatio">--%</p>
                </div>
                <div class="w-32 h-32 mr-4">
                    <canvas id="assetChart"></canvas>
                </div>
            </div>
        </div>

        <div>
            <div class="flex justify-between items-end mb-3 px-1">
                <h3 class="font-bold text-white text-lg"><i class="fa-solid fa-clock-rotate-left mr-2 text-accent"></i>äº¤æ˜“å¤ç›˜æ—¥å¿—</h3>
                <span class="text-xs text-slate-500">CIO å®¡è®¡ä¸­...</span>
            </div>
            <div id="transactionLog" class="space-y-3">
                <div class="text-center py-10 text-slate-600 text-sm bg-slate-800/30 rounded-2xl border border-slate-800 border-dashed">
                    æš‚æ— æ–°äº¤æ˜“è®°å½•ï¼Œç‚¹å‡»å³ä¸‹è§’ "+" å¼€å§‹å¤ç›˜
                </div>
            </div>
        </div>

        <div class="pt-4 border-t border-slate-800">
             <button onclick="document.getElementById('holdingsArea').classList.toggle('hidden')" class="flex items-center text-sm text-slate-400 hover:text-white transition w-full justify-between">
                <span>æŸ¥çœ‹å½“å‰æŒä»“å¿«ç…§</span>
                <i class="fa-solid fa-chevron-down"></i>
             </button>
             <div id="holdingsArea" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                 </div>
        </div>
    </div>

    <button onclick="openTradeDrawer()" class="fixed bottom-6 right-6 w-14 h-14 bg-accent hover:bg-blue-600 rounded-full shadow-2xl shadow-blue-500/30 flex items-center justify-center text-white text-2xl z-40 transition-transform hover:scale-110 active:scale-95">
        <i class="fa-solid fa-plus"></i>
    </button>

    <div id="tradeDrawer" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeTradeDrawer()"></div>
        
        <div class="absolute bottom-0 left-0 right-0 bg-card rounded-t-3xl border-t border-slate-600 shadow-2xl h-[85vh] transform transition-transform duration-300 translate-y-full flex flex-col" id="drawerContent">
            
            <div class="w-full flex justify-center pt-3 pb-1" onclick="closeTradeDrawer()">
                <div class="w-12 h-1.5 bg-slate-600 rounded-full"></div>
            </div>

            <div class="px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">äº¤æ˜“å†³ç­–å®éªŒå®¤</h2>
                <button onclick="closeTradeDrawer()" class="text-slate-400 hover:text-white bg-slate-800 px-3 py-1 rounded-full text-xs">å–æ¶ˆ</button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                
                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <h3 class="text-xs text-slate-400 uppercase font-bold mb-3">1. äº¤æ˜“æŒ‡ä»¤</h3>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="text-xs text-slate-500 block mb-1">ä»£ç /åç§°</label>
                            <input type="text" id="tCode" placeholder="å¦‚ NVDA" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm outline-none focus:border-accent">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500 block mb-1">æ“ä½œæ–¹å‘</label>
                            <select id="tType" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm outline-none focus:border-accent">
                                <option value="buy">ä¹°å…¥ (æ¶ˆè€—ç°é‡‘)</option>
                                <option value="sell">å–å‡º (å›ç¬¼ç°é‡‘)</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs text-slate-500 block mb-1">æˆäº¤æ€»é¢ (CNY)</label>
                            <input type="number" id="tAmount" placeholder="0" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm outline-none focus:border-accent font-mono font-bold">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500 block mb-1">å½“å‰æƒ…ç»ª</label>
                            <select id="tMood" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm outline-none focus:border-accent">
                                <option value="calm">å†·é™/æŒ‰è®¡åˆ’</option>
                                <option value="fomo">æ€¥èº/æ€•è¸ç©º (FOMO)</option>
                                <option value="panic">ææ…Œ/æ­¢æŸ</option>
                                <option value="bored">æ‰‹ç—’/æƒ³æ“ä½œ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-10"><i class="fa-solid fa-gavel text-6xl"></i></div>
                    <h3 class="text-xs text-accent uppercase font-bold mb-2">2. CIO é€»è¾‘å®¡æŸ¥ (å¿…å¡«)</h3>
                    <p class="text-[10px] text-slate-400 mb-2">è¯·é˜è¿°ä½ çš„ä¹°å–ç†ç”±ã€‚å¦‚æœç†ç”±å°‘äº 10 ä¸ªå­—ï¼Œå°†è¢«åˆ¤å®šä¸ºâ€œæ— æ•ˆäº¤æ˜“â€ã€‚</p>
                    <textarea id="tLogic" class="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white text-sm h-24 outline-none focus:border-accent resize-none" placeholder="ä¾‹å¦‚ï¼šå›è¸© 20 æ—¥å‡çº¿ä¼ç¨³ï¼Œä¸”è¡Œä¸šåŸºæœ¬é¢æ”¹å–„..."></textarea>
                </div>

                <div id="cioPreview" class="hidden text-xs text-slate-400 bg-black/20 p-3 rounded-lg border border-slate-800">
                    <i class="fa-solid fa-robot mr-1"></i> <span id="cioText">ç­‰å¾…è¾“å…¥...</span>
                </div>

            </div>

            <div class="p-6 border-t border-slate-800 bg-card pb-10">
                <button onclick="submitTrade()" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-900/40 text-lg transition transform active:scale-95 flex items-center justify-center">
                    <i class="fa-solid fa-paper-plane mr-2"></i> æäº¤å¹¶å½’æ¡£
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. æ•°æ®ä¸­å¿ƒ (Data Center)
        // ==========================================
        const defaultConfig = {
            exchangeRate: 7.29,
            cashCNY: 220000,
            cashUSD: 18000,
            transactions: [] // äº¤æ˜“è®°å½•è¡¨
        };

        // è¯»å–æˆ–åˆå§‹åŒ–
        let appData = JSON.parse(localStorage.getItem('alphaLogV15')) || defaultConfig;
        
        // åˆå§‹æŒä»“ (å¯ä»¥è¢«äº¤æ˜“ä¿®æ”¹ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œåªåšå±•ç¤º)
        // åœ¨çœŸå®å¼€å‘ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ ¹æ® transactions åŠ¨æ€è®¡ç®—ï¼ŒV1.5 åŸå‹æš‚ç”¨é™æ€åˆ—è¡¨+åŠ¨æ€èµ„é‡‘æ¼”ç¤º
        const staticHoldings = [
            {code: '007339', name: 'æ˜“æ–¹è¾¾æ²ªæ·±300', value: 44016.20, pl: 0.19, category: 'cn'},
            {code: '513200', name: 'æ¸¯è‚¡åŒ»è¯ETF', value: 2558.40, pl: -37.99, category: 'global'},
            {code: '515880', name: 'é€šä¿¡ETF', value: 2826.00, pl: 91.70, category: 'cn'},
            {code: 'USD', name: 'ç¾å…ƒå‚¨å¤‡', value: 18000, pl: 0, category: 'cash', isUsd: true}
        ];

        let chartInstance = null;

        // ==========================================
        // 2. æ ¸å¿ƒåŠŸèƒ½å‡½æ•°
        // ==========================================

        function init() {
            document.getElementById('exchangeRate').value = appData.exchangeRate;
            renderDashboard();
            renderLogs();
            renderHoldings();
        }

        function renderDashboard() {
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            
            // ç®€å•è®¡ç®—ï¼šé™æ€æŒä»“ + åŠ¨æ€ç°é‡‘
            let securitiesVal = staticHoldings.reduce((sum, item) => {
                return sum + (item.isUsd ? item.value * rate : item.value);
            }, 0);

            // åŠ ä¸ŠåŠ¨æ€èµ„é‡‘ (appData.cashCNY å¯èƒ½ä¼šå› ä¸ºäº¤æ˜“è€Œå˜åŠ¨)
            const totalCashRMB = appData.cashCNY; // ç®€åŒ–ï¼šå‡è®¾äº¤æ˜“åªåŠ¨ç”¨äººæ°‘å¸ç°é‡‘æ± 
            const totalAsset = securitiesVal + totalCashRMB;

            document.getElementById('totalAssetDisplay').innerText = "Â¥ " + Math.round(totalAsset).toLocaleString();
            document.getElementById('cashDisplay').innerText = "Â¥ " + Math.round(totalCashRMB).toLocaleString();

            // æ›´æ–°å›¾è¡¨
            updateChart(securitiesVal - (18000*rate), 18000*rate, totalCashRMB);
        }

        function updateChart(equityVal, usdVal, rmbCashVal) {
            const ctx = document.getElementById('assetChart').getContext('2d');
            const total = equityVal + usdVal + rmbCashVal;
            const equityRatio = Math.round(((equityVal + usdVal) / total) * 100);
            
            document.getElementById('equityRatio').innerText = equityRatio + "%";

            const data = {
                labels: ['æƒç›Š', 'ç°é‡‘'],
                datasets: [{
                    data: [equityVal + usdVal, rmbCashVal],
                    backgroundColor: ['#3b82f6', '#334155'],
                    borderWidth: 0,
                    cutout: '75%'
                }]
            };

            if (chartInstance) {
                chartInstance.data = data;
                chartInstance.update();
            } else {
                chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });
            }
        }

        // ==========================================
        // 3. äº¤æ˜“å®éªŒå®¤é€»è¾‘ (æ ¸å¿ƒ)
        // ==========================================

        function openTradeDrawer() {
            const drawer = document.getElementById('tradeDrawer');
            const content = document.getElementById('drawerContent');
            drawer.classList.remove('hidden');
            // ç®€å•çš„åŠ¨ç”»å»¶è¿Ÿ
            setTimeout(() => {
                content.classList.remove('translate-y-full');
            }, 10);
        }

        function closeTradeDrawer() {
            const drawer = document.getElementById('tradeDrawer');
            const content = document.getElementById('drawerContent');
            content.classList.add('translate-y-full');
            setTimeout(() => {
                drawer.classList.add('hidden');
            }, 300);
        }

        function submitTrade() {
            const code = document.getElementById('tCode').value;
            const type = document.getElementById('tType').value;
            const amount = parseFloat(document.getElementById('tAmount').value);
            const logic = document.getElementById('tLogic').value;
            const mood = document.getElementById('tMood').value;

            // 1. åŸºç¡€æ ¡éªŒ
            if (!code || !amount) {
                alert("è¯·è¡¥å…¨ä»£ç å’Œé‡‘é¢");
                return;
            }

            // 2. çµé­‚æ‹·é—®æ ¡éªŒ (CIO é€»è¾‘)
            if (logic.length < 10) {
                alert("ğŸ›‘ CIO é©³å›ï¼š\næ‚¨çš„äº¤æ˜“é€»è¾‘è¿‡äºç®€å•ï¼\nè¯·è¯¦ç»†é˜è¿°ä¸ºä»€ä¹ˆæ“ä½œï¼Œå¦åˆ™è§†ä¸ºèµŒåšã€‚");
                return;
            }
            if (mood === 'fomo' || mood === 'bored') {
                if(!confirm("âš ï¸ CIO é£é™©è­¦æŠ¥ï¼š\nç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨å½“å‰æƒ…ç»ªä¸º [æ€¥èº/æ— èŠ]ã€‚\nè¿™ç§çŠ¶æ€ä¸‹äº¤æ˜“èƒœç‡æä½ã€‚ç¡®è®¤è¦å¼ºè¡Œæ“ä½œå—ï¼Ÿ")) {
                    return;
                }
            }

            // 3. æ‰§è¡Œèµ„é‡‘å˜åŠ¨
            if (type === 'buy') {
                appData.cashCNY -= amount;
            } else {
                appData.cashCNY += amount;
            }

            // 4. ç”Ÿæˆ AI ç‚¹è¯„ (æ¨¡æ‹Ÿ)
            let aiComment = "";
            if (logic.includes("å‡çº¿") || logic.includes("æ”¯æ’‘")) {
                aiComment = "æŠ€æœ¯é¢é€»è¾‘æ¸…æ™°ï¼Œå±äºå³ä¾§äº¤æ˜“ã€‚";
            } else if (logic.includes("è·Œå¤ªå¤š") || logic.includes("æŠ„åº•")) {
                aiComment = "âš ï¸ è­¦å‘Šï¼šå·¦ä¾§æŠ„åº•é£é™©è¾ƒå¤§ï¼Œè¯·ä¸¥æ ¼è®¾ç½®æ­¢æŸã€‚";
            } else {
                aiComment = "é€»è¾‘å·²å½’æ¡£ï¼Œå»ºè®®åç»­é‡ç‚¹å¤ç›˜æ­¤ç¬”äº¤æ˜“ã€‚";
            }
            
            if (mood === 'calm') aiComment += " æƒ…ç»ªæ§åˆ¶è‰¯å¥½ã€‚";

            // 5. è®°å½•æµæ°´
            const newTx = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                code: code,
                type: type,
                amount: amount,
                logic: logic,
                mood: mood,
                aiComment: aiComment
            };
            appData.transactions.unshift(newTx);

            // 6. ä¿å­˜å¹¶åˆ·æ–°
            localStorage.setItem('alphaLogV15', JSON.stringify(appData));
            
            // 7. UI åé¦ˆ
            closeTradeDrawer();
            renderDashboard();
            renderLogs();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('tCode').value = '';
            document.getElementById('tAmount').value = '';
            document.getElementById('tLogic').value = '';
        }

        function renderLogs() {
            const container = document.getElementById('transactionLog');
            if (appData.transactions.length === 0) return;
            
            container.innerHTML = '';
            appData.transactions.forEach(tx => {
                const isBuy = tx.type === 'buy';
                const color = isBuy ? 'text-danger' : 'text-success';
                const icon = isBuy ? 'fa-arrow-trend-up' : 'fa-arrow-trend-down';
                const moodBadge = tx.mood === 'calm' ? 'bg-slate-700 text-slate-300' : 'bg-orange-900/50 text-orange-400 border border-orange-800';
                
                const html = `
                <div class="bg-card p-4 rounded-2xl border border-slate-800 hover:border-slate-600 transition">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700">
                                <i class="fa-solid ${icon} ${color} text-xs"></i>
                            </span>
                            <div>
                                <span class="font-bold text-white text-sm">${tx.code}</span>
                                <span class="text-xs text-slate-500 ml-1">${tx.date}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${color} font-mono">${isBuy?'-':'+'}Â¥${tx.amount.toLocaleString()}</div>
                            <span class="text-[10px] px-1.5 rounded ${moodBadge}">${tx.mood.toUpperCase()}</span>
                        </div>
                    </div>
                    
                    <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-800/50">
                        <p class="text-xs text-slate-300 italic mb-2">"${tx.logic}"</p>
                        <div class="flex items-start gap-1.5 border-t border-slate-800 pt-2 mt-2">
                            <i class="fa-solid fa-robot text-accent text-xs mt-0.5"></i>
                            <p class="text-[10px] text-accent font-bold">${tx.aiComment}</p>
                        </div>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderHoldings() {
            const container = document.getElementById('holdingsArea');
            let html = '';
            staticHoldings.forEach(item => {
                html += `
                <div class="bg-slate-800 p-3 rounded-xl flex justify-between items-center">
                    <div>
                        <div class="text-sm font-bold text-white">${item.name}</div>
                        <div class="text-[10px] text-slate-500">${item.code}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-mono text-white">Â¥${item.value.toLocaleString()}</div>
                        <div class="text-[10px] ${item.pl>=0?'text-danger':'text-success'}">${item.pl}%</div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function updateDashboard(save) {
            if(save) {
                appData.exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
                localStorage.setItem('alphaLogV15', JSON.stringify(appData));
            }
            renderDashboard();
        }

        // å¯åŠ¨
        window.onload = init;

    </script>
</body>
</html>
