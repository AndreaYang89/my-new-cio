<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLog V1.3 - åˆ†ç»„ç®¡ç†ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        accent: '#3b82f6',
                        danger: '#ef4444', 
                        success: '#22c55e',
                    }
                }
            }
        }
    </script>
    <style>
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-dark text-slate-200 font-sans antialiased min-h-screen pb-20">

    <nav class="sticky top-0 z-40 bg-dark/80 backdrop-blur-md border-b border-slate-800 px-4 py-3 flex justify-between items-center">
        <div class="flex items-center">
            <div class="w-8 h-8 bg-accent/20 rounded-lg flex items-center justify-center mr-3">
                <i class="fa-solid fa-layer-group text-accent"></i>
            </div>
            <h1 class="font-bold text-lg tracking-tight text-white">AlphaLog</h1>
        </div>
        
        <div class="flex items-center space-x-3">
            <div class="hidden md:flex items-center bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                <span class="text-xs text-slate-400 mr-2">USD</span>
                <input type="number" id="exchangeRate" value="7.28" class="w-10 bg-transparent text-right font-bold text-white text-xs focus:outline-none" onchange="updateDashboard()">
            </div>
            
            <button onclick="openModal()" class="bg-accent hover:bg-blue-600 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg shadow-blue-900/20 transition flex items-center">
                <i class="fa-solid fa-pen-to-square mr-2"></i> è®°ä¸€ç¬”
            </button>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto p-4 space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-2xl border border-slate-700 shadow-xl">
                <p class="text-slate-400 text-xs font-medium uppercase tracking-wider">å‡€èµ„äº§æ€»é¢ (CNY Estimate)</p>
                <div class="flex justify-between items-end mt-2">
                    <h2 class="text-3xl font-bold text-white font-mono" id="totalAsset">---</h2>
                    <span class="text-xs text-emerald-400 bg-emerald-900/30 px-2 py-1 rounded">+12.4% YTD</span>
                </div>
            </div>

            <div class="bg-slate-800 p-5 rounded-2xl border border-slate-700 relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 text-slate-700/20 text-9xl group-hover:text-slate-700/30 transition">
                    <i class="fa-solid fa-sack-dollar"></i>
                </div>
                <div class="relative z-10">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-slate-400 text-xs uppercase">ç¾å…ƒæˆ˜ç•¥å‚¨å¤‡ (è´­è½¦)</p>
                        <span class="text-[10px] bg-slate-700 text-slate-300 px-1.5 py-0.5 rounded">USD</span>
                    </div>
                    <div class="flex items-baseline space-x-2">
                        <span class="text-2xl font-bold text-white font-mono">$18,000</span>
                        <span class="text-xs text-slate-500" id="usdCnyVal">â‰ˆ Â¥---</span>
                    </div>
                    <div class="w-full bg-slate-700 h-1.5 rounded-full mt-3">
                        <div class="bg-emerald-500 h-1.5 rounded-full transition-all duration-1000" id="carProgress" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-1 flex justify-between">
                        <span>å½“å‰æ±‡ç‡ 7.28</span>
                        <span>ç›®æ ‡è¿›åº¦ <span id="carPercent">0%</span></span>
                    </p>
                </div>
            </div>
        </div>

        <div class="flex space-x-1 bg-slate-800/50 p-1 rounded-xl overflow-x-auto no-scrollbar">
            <button onclick="switchTab('all')" class="tab-btn active flex-1 text-sm py-2 px-4 rounded-lg font-medium transition text-center whitespace-nowrap" data-tab="all">
                å…¨éƒ¨æŒä»“
            </button>
            <button onclick="switchTab('cn')" class="tab-btn flex-1 text-sm py-2 px-4 rounded-lg font-medium transition text-center text-slate-400 hover:text-white whitespace-nowrap" data-tab="cn">
                ğŸ‡¨ğŸ‡³ Aè‚¡æ ¸å¿ƒ
            </button>
            <button onclick="switchTab('global')" class="tab-btn flex-1 text-sm py-2 px-4 rounded-lg font-medium transition text-center text-slate-400 hover:text-white whitespace-nowrap" data-tab="global">
                ğŸŒ QDII/æ¸¯ç¾
            </button>
            <button onclick="switchTab('cash')" class="tab-btn flex-1 text-sm py-2 px-4 rounded-lg font-medium transition text-center text-slate-400 hover:text-white whitespace-nowrap" data-tab="cash">
                ğŸ’µ ç°é‡‘
            </button>
        </div>

        <div id="portfolioContainer" class="space-y-4">
            </div>

    </div>

    <div id="tradeModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="bg-card w-full max-w-md rounded-2xl border border-slate-600 shadow-2xl overflow-hidden animate-fade-in-up">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800">
                <h3 class="text-white font-bold"><i class="fa-solid fa-pen-nib mr-2 text-accent"></i>å½•å…¥äº¤æ˜“</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="p-6 space-y-4">
                <div class="flex gap-2 justify-center pb-2">
                    <button type="button" onclick="setCategory('cn')" class="text-xs border border-slate-600 px-3 py-1 rounded-full text-slate-300 hover:bg-accent hover:border-accent hover:text-white transition">Aè‚¡</button>
                    <button type="button" onclick="setCategory('global')" class="text-xs border border-slate-600 px-3 py-1 rounded-full text-slate-300 hover:bg-purple-600 hover:border-purple-600 hover:text-white transition">ç¾è‚¡/QDII</button>
                    <button type="button" onclick="setCategory('cash')" class="text-xs border border-slate-600 px-3 py-1 rounded-full text-slate-300 hover:bg-emerald-600 hover:border-emerald-600 hover:text-white transition">ç°é‡‘å˜åŠ¨</button>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] text-slate-400 uppercase mb-1">ä»£ç /åç§°</label>
                        <input type="text" id="inputCode" placeholder="å¦‚ NVDA" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:border-accent outline-none text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-slate-400 uppercase mb-1">é‡‘é¢ (å¸‚å€¼)</label>
                        <input type="number" id="inputValue" placeholder="10000" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:border-accent outline-none text-sm">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-slate-400 uppercase mb-1">å½“å‰ç›ˆäºç‡ (%)</label>
                    <div class="flex items-center space-x-2">
                         <input type="number" id="inputPl" placeholder="-5.2" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:border-accent outline-none text-sm">
                         <span class="text-xs text-slate-500">%</span>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] text-accent font-bold uppercase mb-1">CIO å¿…å¡«ï¼šæŒä»“é€»è¾‘</label>
                    <textarea id="inputLogic" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm h-20 focus:border-accent outline-none" placeholder="ä¸ºä»€ä¹ˆæŒæœ‰ï¼Ÿè®¡åˆ’ä»€ä¹ˆæ—¶å€™å–ï¼Ÿ..."></textarea>
                </div>

                <button onclick="addTransaction()" class="w-full bg-accent hover:bg-blue-600 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-blue-900/50">
                    ç¡®è®¤è®°è´¦
                </button>
            </div>
        </div>
    </div>

    <script>
        // 1. åˆå§‹åŒ–æ•°æ® (åŒ…å«åˆ†ç±»æ ‡ç­¾)
        let myData = [
            // --- Aè‚¡ (CNY) ---
            { id: 1, name: "æ˜“æ–¹è¾¾æ·±è¯100", code: "004742", value: 49186, pl: 15.1, category: "cn", logic: "æ ¸å¿ƒå®½åŸºåº•ä»“" },
            { id: 2, name: "æ˜“æ–¹è¾¾æ²ªæ·±300", code: "007339", value: 44016, pl: 13.5, category: "cn", logic: "æ ¸å¿ƒå®½åŸºåº•ä»“" },
            { id: 3, name: "å…‰ä¼é¾™å¤´ETF", code: "560980", value: 16445, pl: 5.0, category: "cn", logic: "è¡Œä¸šè½®åŠ¨é…ç½®" },
            { id: 4, name: "ç§‘åˆ›åˆ›ä¸š50", code: "159781", value: 14905, pl: 4.5, category: "cn", logic: "ç§‘æŠ€æˆé•¿æ–¹å‘" },
            { id: 5, name: "æœ‰è‰²ETF", code: "512400", value: 14406, pl: 4.4, category: "cn", logic: "å‘¨æœŸèµ„æºè‚¡" },
            { id: 6, name: "å¯Œå›½ä¸Šæµ·é‡‘", code: "009505", value: 8324, pl: 2.5, category: "cn", logic: "é»„é‡‘é¿é™©" },
            { id: 7, name: "èŠ¯ç‰‡ç§‘åˆ›ETF", code: "588290", value: 8003, pl: -2.3, category: "cn", logic: "åŠå¯¼ä½“å¤è‹é€»è¾‘ï¼ˆå¥—ç‰¢ä¸­ï¼‰" },
            { id: 8, name: "é€šä¿¡ETF", code: "515880", value: 2826, pl: 91.7, category: "cn", logic: "MVPæŒä»“ï¼Œæˆæœ¬æä½" },

            // --- å…¨çƒ/QDII (Global) ---
            { id: 10, name: "æ—¥ç»225 ETF", code: "513880", value: 14711, pl: -6.6, category: "global", logic: "åˆ†æ•£å›½åˆ«é£é™©" },
            { id: 11, name: "å¤©å¼˜è¶Šå—å¸‚åœº", code: "008764", value: 9073, pl: -7.5, category: "global", logic: "æ–°å…´å¸‚åœºé…ç½®" },
            { id: 12, name: "åå®çº³æ–¯è¾¾å…‹", code: "017436", value: 6059, pl: -3.3, category: "global", logic: "ç¾è‚¡ç§‘æŠ€" },
            { id: 13, name: "æ¸¯è‚¡åŒ»è¯ETF", code: "513200", value: 2558, pl: -40.1, category: "global", logic: "ä¸¥é‡è¶…è·Œï¼Œç­‰å¾…åå¼¹å†³ç­–" },

            // --- ç°é‡‘ (Cash) ---
            { id: 20, name: "ç¾å…ƒç°é‡‘å‚¨å¤‡", code: "USD", value: 18000, pl: 5.0, category: "cash", logic: "è´­è½¦åŸºé‡‘/é¿é™©å‚¨å¤‡", currency: "USD" }
        ];

        let currentTab = 'all';

        // æ¸²æŸ“å‡½æ•°
        function renderPortfolio() {
            const container = document.getElementById('portfolioContainer');
            container.innerHTML = ''; // æ¸…ç©º

            const usdRate = parseFloat(document.getElementById('exchangeRate').value);
            
            // 1. è¿‡æ»¤æ•°æ®
            let filteredData = myData;
            if (currentTab !== 'all') {
                filteredData = myData.filter(item => item.category === currentTab);
            }

            // 2. æŒ‰åˆ†ç±»åˆ†ç»„æ¸²æŸ“ (å¦‚æœæ˜¯ All Tab)
            if (currentTab === 'all') {
                renderSection("ğŸ‡¨ğŸ‡³ Aè‚¡æ ¸å¿ƒèµ„äº§", myData.filter(i => i.category === 'cn'), usdRate);
                renderSection("ğŸŒ å…¨çƒ/QDIIèµ„äº§", myData.filter(i => i.category === 'global'), usdRate);
                renderSection("ğŸ’µ ç°é‡‘å‚¨å¤‡", myData.filter(i => i.category === 'cash'), usdRate);
            } else {
                // å¦‚æœæ˜¯ç‰¹å®š Tabï¼Œç›´æ¥æ¸²æŸ“åˆ—è¡¨
                renderSection("", filteredData, usdRate);
            }

            updateTotalAssets(usdRate);
        }

        // æ¸²æŸ“å•ä¸ªåŒºå—
        function renderSection(title, items, rate) {
            if (items.length === 0) return;

            const container = document.getElementById('portfolioContainer');
            
            // å¦‚æœæœ‰æ ‡é¢˜ï¼ˆAllæ¨¡å¼ä¸‹ï¼‰ï¼ŒåŠ ä¸ªå°æ ‡é¢˜
            if (title) {
                container.innerHTML += `<h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mt-6 mb-2 ml-1">${title}</h3>`;
            }

            let html = '';
            items.sort((a,b) => b.value - a.value).forEach(item => {
                let val = item.value;
                let symbol = 'Â¥';
                if (item.category === 'cash' && item.currency === 'USD') {
                    val = item.value * rate; // è½¬RMBè®¡ç®—æ’åºå’Œå±•ç¤º
                    symbol = '$'; // å±•ç¤ºåŸå¸ç§ç¬¦å·
                }
                
                // é¢œè‰²é€»è¾‘
                const isProfit = item.pl >= 0;
                const colorClass = isProfit ? 'text-danger' : 'text-success';
                const plText = (item.pl > 0 ? '+' : '') + item.pl + '%';

                // åˆ¤æ–­æ˜¯å¦æ˜¯ç¾å…ƒæ˜¾ç¤ºåŸå€¼
                const displayValue = (item.currency === 'USD') ? 
                    `$${item.value.toLocaleString()}` : 
                    `Â¥${item.value.toLocaleString()}`;

                html += `
                <div class="bg-card p-4 rounded-xl border border-slate-700/50 hover:border-slate-600 transition flex justify-between items-start group relative overflow-hidden">
                    
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-white">${item.name}</span>
                            <span class="text-[10px] text-slate-500 font-mono bg-slate-800 px-1 rounded">${item.code}</span>
                        </div>
                        <div class="mt-1.5 flex items-start text-xs text-slate-400 max-w-[200px] md:max-w-xs">
                            <i class="fa-solid fa-quote-left text-slate-600 text-[10px] mr-1.5 mt-0.5"></i>
                            <span class="italic leading-tight">${item.logic || 'æš‚æ— é€»è¾‘å¤‡æ³¨'}</span>
                        </div>
                    </div>

                    <div class="text-right z-10">
                        <div class="font-bold text-white font-mono">${displayValue}</div>
                        <div class="text-xs font-bold ${colorClass} mt-0.5 bg-slate-800/50 px-1.5 py-0.5 rounded inline-block">
                            ${plText}
                        </div>
                    </div>
                </div>`;
            });

            container.innerHTML += `<div class="grid gap-3">${html}</div>`;
        }

        // è®¡ç®—æ€»èµ„äº§
        function updateTotalAssets(rate) {
            let total = 0;
            let usdTotalInCny = 0;

            myData.forEach(item => {
                if (item.currency === 'USD') {
                    let cnyVal = item.value * rate;
                    total += cnyVal;
                    if(item.category === 'cash') usdTotalInCny += cnyVal;
                } else {
                    total += item.value;
                }
            });

            document.getElementById('totalAsset').innerText = "Â¥ " + total.toLocaleString('zh-CN', { maximumFractionDigits: 0 });
            
            // æ›´æ–°è´­è½¦è¿›åº¦
            document.getElementById('usdCnyVal').innerText = `â‰ˆ Â¥${usdTotalInCny.toLocaleString('zh-CN', { maximumFractionDigits: 0 })}`;
            const percent = Math.min((usdTotalInCny / 300000) * 100, 100);
            document.getElementById('carProgress').style.width = percent + "%";
            document.getElementById('carPercent').innerText = percent.toFixed(1) + "%";
        }

        // Tab åˆ‡æ¢é€»è¾‘
        function switchTab(tab) {
            currentTab = tab;
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.dataset.tab === tab) {
                    btn.classList.add('bg-accent', 'text-white');
                    btn.classList.remove('text-slate-400');
                } else {
                    btn.classList.remove('bg-accent', 'text-white');
                    btn.classList.add('text-slate-400');
                }
            });
            renderPortfolio();
        }

        function updateDashboard() {
            renderPortfolio();
        }

        // --- æ¨¡æ€æ¡†é€»è¾‘ ---
        function openModal() {
            document.getElementById('tradeModal').classList.remove('hidden');
        }
        function closeModal() {
            document.getElementById('tradeModal').classList.add('hidden');
        }
        
        let selectedCategory = 'cn';
        function setCategory(cat) {
            selectedCategory = cat;
            // ç®€å•çš„è§†è§‰åé¦ˆ
            alert("å·²é€‰æ‹©åˆ†ç±»: " + (cat==='cn'?'Aè‚¡':(cat==='global'?'ç¾è‚¡/QDII':'ç°é‡‘'))); 
        }

        function addTransaction() {
            const code = document.getElementById('inputCode').value;
            const value = parseFloat(document.getElementById('inputValue').value);
            const pl = parseFloat(document.getElementById('inputPl').value);
            const logic = document.getElementById('inputLogic').value;

            if(!code || !value) {
                alert("è¯·è‡³å°‘å¡«å†™ä»£ç å’Œé‡‘é¢");
                return;
            }

            // æ·»åŠ åˆ°æ•°æ®æº
            const newItem = {
                id: Date.now(),
                name: code, // æš‚æ—¶ç”¨ä»£ç å½“åå­—
                code: code,
                value: value,
                pl: pl || 0,
                category: selectedCategory,
                logic: logic,
                currency: selectedCategory === 'cash' ? 'USD' : 'CNY' // ç®€å•å‡è®¾ç°é‡‘éƒ½æ˜¯USD
            };

            myData.unshift(newItem); // åŠ åˆ°æœ€å‰é¢
            closeModal();
            renderPortfolio(); // é‡æ–°æ¸²æŸ“
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('inputCode').value = '';
            document.getElementById('inputValue').value = '';
            document.getElementById('inputLogic').value = '';
        }

        // å¯åŠ¨
        // åˆå§‹åŒ– Tab æ ·å¼
        switchTab('all');
    </script>
</body>
</html>
